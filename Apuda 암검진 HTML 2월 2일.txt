<!DOCTYPE html> 
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ë°˜ì‘í˜• ì›¹ì„ ìœ„í•œ ë·°í¬íŠ¸ ì„¤ì • -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ApuDa ì•”ê²€ì§„ ì‹œìŠ¤í…œ</title>
  <!-- Google Fonts (Montserrat) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ì „ì²´ í…ìŠ¤íŠ¸ 25% í™•ëŒ€ (html ê¸°ë³¸) */
    html { font-size: 125%; }
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f0f2f5, #d9e2ec);
      color: #333;
      line-height: 1.6;
    }
    /* ì»¨í…Œì´ë„ˆ â€“ ì¹´ë“œ í˜•íƒœ, position:relative (ì›Œí„°ë§ˆí¬ ë°°ê²½ìš©) */
    .container {
      position: relative;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      text-align: center;
      overflow: hidden;
    }
    /* ìƒë‹¨ í—¤ë” í…ìŠ¤íŠ¸ (í˜ì´ì§€2,3ì—ë§Œ í‘œì‹œ) â€“ ê¸°ì¡´ë³´ë‹¤ 30% í¬ê²Œ, íŒŒë€ìƒ‰ ë³¼ë“œì²´ */
    .header-watermark {
      text-align: center;
      color: #007BFF;
      font-weight: bold;
      opacity: 0.5;
      margin-bottom: 10px;
    }
    .header-watermark .wm-subtitle { font-size: 1.95em; margin: 0; }
    .header-watermark .wm-title { font-size: 2.6em; margin: 0; }
    /* í˜ì´ì§€ êµ¬ì—­ */
    .page-section { display: none; padding: 20px 0; }
    .page-section.active { display: block; }
    h1, h2, h3 { margin-bottom: 15px; position: relative; z-index: 1; }
    /* ê¸°ë³¸ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ â€“ í…ìŠ¤íŠ¸ í¬ê¸° 1em (ê¸°ì¡´ 1.3emë³´ë‹¤ 25% ì¤„ì„) */
    .select-btn, .btn { font-size: 1em; }
    .select-btn {
      padding: 10px 14px; margin: 6px;
      border: 1px solid #007BFF; border-radius: 4px;
      cursor: pointer; background-color: #fff;
      transition: background-color 0.2s ease, transform 0.2s ease;
      word-break: break-word;
    }
    .select-btn:hover { transform: scale(1.03); }
    /* ì„ íƒ ì‹œ: íŒŒë€ ë°°ê²½, í°ìƒ‰ ê¸€ì”¨ */
    .select-btn.selected { background-color: #007BFF; color: #fff; }
    /* ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ â€“ ê¸°ë³¸ í°ìƒ‰ ë°°ê²½, íŒŒë€ í…Œë‘ë¦¬, í´ë¦­ ì‹œ íŒŒë€ ë°°ê²½/í°ìƒ‰ ê¸€ì”¨ */
    .btn {
      padding: 12px 24px; margin: 10px;
      cursor: pointer; border: 1px solid #007BFF; border-radius: 4px;
      background-color: #fff; color: #007BFF;
      transition: background-color 0.2s ease, transform 0.2s ease;
      word-break: break-word;
    }
    .btn:hover { background-color: #007BFF; color: #fff; transform: scale(1.02); }
    .btn:disabled { background-color: #ccc; cursor: not-allowed; }
    /* ê²°ê³¼ í˜ì´ì§€ â€“ íƒ€ë¡œ ì¹´ë“œ ëŠë‚Œ ë””ìì¸ (ê° ì¹´ë“œì— ì¢…ì´ ì§ˆê° ë°°ê²½ ì ìš©) */
    .info-card {
      border: 1px solid #ccc;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      /* ê¸°ë³¸ pastel ë°°ê²½ + ì¢…ì´ ì§ˆê° íŒ¨í„´ */
      background: linear-gradient(135deg, #fff, #fdfdfd),
                  url("https://www.transparenttextures.com/patterns/old-mathematics.png");
      background-blend-mode: multiply;
      position: relative;
      z-index: 1;
    }
    /* info-card ê°ê°ì˜ ìƒ‰ìƒ */
    .card-orange { background-color: #FFECB3; }
    .card-blue { background-color: #E3F2FD; }
    .card-green { background-color: #C8E6C9; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
      font-size: 1em;
    }
    table, th, td { border: 1px solid #aaa; }
    th, td { padding: 10px; text-align: center; word-break: break-word; }
    /* ê²°ê³¼ í˜ì´ì§€ â€“ ì „ì²´ í…ìŠ¤íŠ¸ 20% ì¶•ì†Œ */
    .result-container { font-size: 0.8em; }
    /* ê²°ê³¼ í˜ì´ì§€ ì œëª© â€“ íŒŒë€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë°°ê²½ #007BFF, í°ìƒ‰ ë³¼ë“œ í…ìŠ¤íŠ¸) */
    .result-title {
      background-color: #007BFF;
      color: #fff;
      font-weight: bold;
      padding: 10px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }
    /* Footer â€“ ëª¨ë“  í˜ì´ì§€ì— ë„¤ì´ë²„ ì¹´í˜ ë¡œê³  í¬í•¨ */
    .footer {
      margin-top: 30px; text-align: center; font-size: 0.9em;
      color: #555; position: relative; z-index: 1;
    }
    .footer img { width: 300px; max-width: 100%; }
    /* ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ */
    @media (max-width: 768px) {
      .container { padding: 10px; max-width: 95%; }
      .select-btn { padding: 8px 12px; margin: 4px; }
      .btn { padding: 10px 20px; margin: 8px; }
      table, th, td { font-size: 1em; }
    }
  </style>
</head>
<body>
  <!-- =======================
       1. ì „ì—­ ë³€ìˆ˜ ë° CSV ë°ì´í„° ë¡œë“œ
  ======================= -->
  <script>
    // ì „ì—­ ë³€ìˆ˜
    let selectedAge = "";
    let selectedGender = "";
    let maleSymptoms = [];
    let femaleSymptoms = [];
    let selectedSymptoms = [];
    let currentSymptomPage = 1;

    // CSV íŒŒì¼ ì£¼ì†Œ (ë‚¨ì„± CSV ìµœì‹  ë‚´ìš© ë°˜ì˜)
    const csvUrls = {
      "ë‚¨ì„±": "https://raw.githubusercontent.com/Mespital/apuda-data/main/male50.csv",
      "ì—¬ì„±": "https://raw.githubusercontent.com/Mespital/apuda-data/main/female50.csv"
    };

    // CSV íŒŒì„œ í•¨ìˆ˜ (í—¤ë”: ë²ˆí˜¸,ì¦ìƒ,ìœ„í—˜ì§ˆí™˜,ê²€ì§„ì œì•ˆ,ì•” ì„¤ëª…)
    function parseCSVData(csvText) {
      const lines = csvText.trim().split("\n");
      const result = [];
      for (let i = 1; i < lines.length; i++) {
        const fields = lines[i].split(",");
        if (fields.length < 5) continue;
        result.push({
          id: fields[0].trim(),
          symptom: fields[1].trim(),
          riskDisease: fields[2].trim(),
          examSuggestion: fields[3].trim(),
          cancerDesc: fields.slice(4).join(",").trim()
        });
      }
      return result;
    }

    // CSV ë°ì´í„° fetch
    fetch(csvUrls["ë‚¨ì„±"])
      .then(response => response.text())
      .then(text => { maleSymptoms = parseCSVData(text); })
      .catch(err => console.error("ë‚¨ì„± CSV ë¡œë“œ ì—ëŸ¬:", err));
      
    fetch(csvUrls["ì—¬ì„±"])
      .then(response => response.text())
      .then(text => { femaleSymptoms = parseCSVData(text); })
      .catch(err => console.error("ì—¬ì„± CSV ë¡œë“œ ì—ëŸ¬:", err));

    // í˜„ì¬ ì„±ë³„ì— ë”°ë¥¸ ì¦ìƒ ë°°ì—´ ë°˜í™˜
    function getCurrentSymptoms() {
      return (selectedGender === "ë‚¨ì„±") ? maleSymptoms : femaleSymptoms;
    }

    // êµ­ê°€ ì•”ê²€ì§„ ê°€ì´ë“œë¼ì¸ â€“ í•­ìƒ ë””í´íŠ¸ ë‚´ìš© ë…¸ì¶œ
    const screeningGuidelinesHTML = `
      <h2>âœ… êµ­ê°€ ì•” ê²€ì§„ ëŒ€ìƒ ë° í•­ëª©</h2>
      <table>
        <tr>
          <th>ì•” ì¢…ë¥˜</th>
          <th>ê²€ì§„ ëŒ€ìƒ (ë‚˜ì´ ê¸°ì¤€)</th>
          <th>ê²€ì§„ ì£¼ê¸°</th>
          <th>ê²€ì§„ ë°©ë²•</th>
          <th>ë¹„ê³ </th>
        </tr>
        <tr>
          <td>ìœ„ì•”</td>
          <td>ë§Œ 40ì„¸ ì´ìƒ ë‚¨ë…€</td>
          <td>2ë…„ë§ˆë‹¤</td>
          <td>ìœ„ë‚´ì‹œê²½ (ë˜ëŠ” ìœ„ì¥ì¡°ì˜ê²€ì‚¬)</td>
          <td>ìœ„ë‚´ì‹œê²½ì´ ì„ í˜¸ë¨</td>
        </tr>
        <tr>
          <td>ëŒ€ì¥ì•”</td>
          <td>ë§Œ 50ì„¸ ì´ìƒ ë‚¨ë…€</td>
          <td>1ë…„ë§ˆë‹¤</td>
          <td>ë¶„ë³€ì í˜ˆê²€ì‚¬ (ì–‘ì„± ì‹œ ëŒ€ì¥ë‚´ì‹œê²½)</td>
          <td>ê³ ìœ„í—˜êµ°ì€ ëŒ€ì¥ë‚´ì‹œê²½ ê¶Œì¥</td>
        </tr>
        <tr>
          <td>ê°„ì•”</td>
          <td>ë§Œ 40ì„¸ ì´ìƒ ê³ ìœ„í—˜êµ°</td>
          <td>6ê°œì›”ë§ˆë‹¤</td>
          <td>ê°„ ì´ˆìŒíŒŒ ê²€ì‚¬, ê°„ì•” í‘œì§€ì ê²€ì‚¬(AFP)</td>
          <td>Bí˜•/Cí˜• ê°„ì—¼, ê°„ê²½ë³€ì¦ ë“± ê³ ìœ„í—˜êµ° í•´ë‹¹</td>
        </tr>
        <tr>
          <td>ìœ ë°©ì•”</td>
          <td>ë§Œ 40ì„¸ ì´ìƒ ì—¬ì„±</td>
          <td>2ë…„ë§ˆë‹¤</td>
          <td>ìœ ë°© ì´¬ì˜ìˆ (ë§˜ëª¨ê·¸ë¨)</td>
          <td>í•„ìš” ì‹œ ìœ ë°© ì´ˆìŒíŒŒ ì¶”ê°€</td>
        </tr>
        <tr>
          <td>ìê¶ê²½ë¶€ì•”</td>
          <td>ë§Œ 20ì„¸ ì´ìƒ ì—¬ì„±</td>
          <td>2ë…„ë§ˆë‹¤</td>
          <td>ìê¶ê²½ë¶€ ì„¸í¬ê²€ì‚¬ (Pap smear)</td>
          <td>HPV ê²€ì‚¬ ë³‘í–‰ ê°€ëŠ¥</td>
        </tr>
        <tr>
          <td>íì•” (ê³ ìœ„í—˜êµ°)</td>
          <td>ë§Œ 54~74ì„¸, 30ê°‘ë…„ ì´ìƒ í¡ì—°ì</td>
          <td>2ë…„ë§ˆë‹¤</td>
          <td>ì €ì„ ëŸ‰ í‰ë¶€ CT</td>
          <td>íì•” ê³ ìœ„í—˜êµ°ì— í•œí•¨</td>
        </tr>
      </table>
    `;
  </script>

  <!-- =======================
       2. í˜ì´ì§€ ì´ë™ ë° í•„ìˆ˜ í•­ëª© ê²€ì¦
  ======================= -->
  <script>
    function showPage(pageId) {
      document.querySelectorAll('.page-section').forEach(pg => pg.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }
    function goToPage2() {
      // ì²« í˜ì´ì§€ "ê²€ì‚¬ ì‹œì‘" ë²„íŠ¼ì€ ë°”ë¡œ í˜ì´ì§€2ë¡œ ì´ë™
      showPage('page2');
    }
    function goToSymptomPage(pageNumber) {
      // í˜ì´ì§€2(ì—°ë ¹/ì„±ë³„) ê²€ì¦
      if (!selectedAge || !selectedGender) {
        alert("í•´ë‹¹ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”");
        return;
      }
      currentSymptomPage = pageNumber;
      renderSymptomPage();
      showPage('page3');
    }
    function nextSymptomPage() {
      // ì¦ìƒ ì„ íƒ í˜ì´ì§€ ê²€ì¦: í˜„ì¬ í˜ì´ì§€ ë‚´ì—ì„œ ìµœì†Œ í•˜ë‚˜ ì„ íƒë˜ì–´ì•¼ í•¨
      if (!validateSymptomPage()) {
        alert("í•´ë‹¹ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”");
        return;
      }
      if (currentSymptomPage < 5) {
        currentSymptomPage++;
        renderSymptomPage();
      } else {
        renderResultsPage();
        showPage('page8');
      }
    }
    function previousSymptomPage() {
      if (currentSymptomPage === 1) {
        showPage('page2');
      } else {
        currentSymptomPage--;
        renderSymptomPage();
      }
    }
    function restart() {
      // ê²°ê³¼ í˜ì´ì§€ "ë‹¤ì‹œ ê²€ì‚¬" ë²„íŠ¼: ì²« í˜ì´ì§€ë¡œ ëŒì•„ê°
      selectedAge = "";
      selectedGender = "";
      selectedSymptoms = [];
      currentSymptomPage = 1;
      document.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('selected'));
      showPage('page1');
    }
    // í˜„ì¬ ì¦ìƒ í˜ì´ì§€ì—ì„œ ìµœì†Œ í•œ í•­ëª© ì„ íƒ ê²€ì¦ (ì¼ë°˜ ì¦ìƒ ë˜ëŠ” "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ì„ íƒ)
    function validateSymptomPage() {
      const symptoms = getCurrentSymptoms();
      const startIdx = (currentSymptomPage - 1) * 10;
      const endIdx = currentSymptomPage * 10;
      const currentSlice = symptoms.slice(startIdx, endIdx);
      if (selectedSymptoms.some(s => s.id === "None" + currentSymptomPage)) {
        return true;
      }
      return currentSlice.some(sym => selectedSymptoms.some(s => s.id === sym.id));
    }
  </script>

  <!-- =======================
       3. ê°ì¢… ë²„íŠ¼ ì„ íƒ ë¡œì§
  ======================= -->
  <script>
    // ì—°ë ¹ ë° ì„±ë³„ ì„ íƒ ë²„íŠ¼ â€“ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ, í´ë¦­ ì‹œ selected í´ë˜ìŠ¤ë§Œ ì¶”ê°€
    function toggleSelection(target, type, value) {
      document.querySelectorAll(`.select-btn[data-type="${type}"]`).forEach(btn => {
        btn.classList.remove('selected');
      });
      target.classList.add('selected');
      if (type === "age") selectedAge = value;
      if (type === "gender") selectedGender = value;
    }
    // ì¦ìƒ ì„ íƒ â€“ ì¼ë°˜ ì¦ìƒ ë²„íŠ¼ê³¼ "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ë²„íŠ¼ êµ¬ë¶„
    function toggleSymptomSelection(symptomObj, btnElement) {
      // ë‹¤ë¥¸ ì¦ìƒ ë²„íŠ¼ í´ë¦­ ì‹œ "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ì„ íƒ ì œê±° (ê°€ì§œ ì„ íƒ ê°ì²´)
      selectedSymptoms = selectedSymptoms.filter(item => !item.id.startsWith("None"));
      const exists = selectedSymptoms.find(item => item.id === symptomObj.id);
      if (exists) {
        selectedSymptoms = selectedSymptoms.filter(item => item.id !== symptomObj.id);
        btnElement.classList.remove('selected');
      } else {
        selectedSymptoms.push(symptomObj);
        btnElement.classList.add('selected');
      }
      renderSymptomPage(); // ë³€ê²½ëœ ì„ íƒ ìƒíƒœë¥¼ ì¦‰ì‹œ ë°˜ì˜
    }
    // "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ë²„íŠ¼ â€“ í† ê¸€ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •
    function clearCurrentPageSelections() {
      const noneId = "None" + currentSymptomPage;
      const isNoneSelected = selectedSymptoms.some(item => item.id === noneId);
      
      if (isNoneSelected) {
        // ì´ë¯¸ ì„ íƒë˜ì–´ ìˆë‹¤ë©´ í•´ì œ
        selectedSymptoms = selectedSymptoms.filter(item => item.id !== noneId);
      } else {
        // í˜„ì¬ í˜ì´ì§€ì˜ ë‹¤ë¥¸ ì¦ìƒ ì„ íƒë“¤ì„ ì œê±°í•œ í›„ "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ì„ íƒ ì¶”ê°€
        const start = (currentSymptomPage - 1) * 10 + 1;
        const end = currentSymptomPage * 10;
        selectedSymptoms = selectedSymptoms.filter(item => {
          const num = parseInt(item.id);
          return isNaN(num) || num < start || num > end;
        });
        const noneObj = { id: noneId, symptom: "í•´ë‹¹ ì¦ìƒ ì—†ìŒ", riskDisease: "ì—†ìŒ", examSuggestion: "ì—†ìŒ", cancerDesc: "ì—†ìŒ" };
        selectedSymptoms.push(noneObj);
      }
      renderSymptomPage();
    }
  </script>

  <!-- =======================
       4. ì¦ìƒ ì„ íƒ í˜ì´ì§€ ë™ì  ë Œë”ë§
  ======================= -->
  <script>
    function renderSymptomPage() {
      // í˜ì´ì§€ ìƒë‹¨ ì œëª©: "ë‚¨ì„± ì¦ìƒ ì„ íƒ X" ë˜ëŠ” "ì—¬ì„± ì¦ìƒ ì„ íƒ X"
      const heading = document.getElementById("symptom-heading");
      heading.textContent = (selectedGender === "ë‚¨ì„±" ? "ë‚¨ì„±" : "ì—¬ì„±") + " ì¦ìƒ ì„ íƒ " + currentSymptomPage;
      const container = document.getElementById("symptom-container");
      container.innerHTML = "";
      const symptoms = getCurrentSymptoms();
      if (!symptoms || symptoms.length === 0) {
        container.innerHTML = "<p>ì¦ìƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>";
        return;
      }
      const startIdx = (currentSymptomPage - 1) * 10;
      const endIdx = currentSymptomPage * 10;
      const currentSlice = symptoms.slice(startIdx, endIdx);
      currentSlice.forEach(sym => {
        const btn = document.createElement("button");
        btn.className = "select-btn";
        btn.textContent = sym.id + ". " + sym.symptom;
        if (selectedSymptoms.find(item => item.id === sym.id)) {
          btn.classList.add("selected");
        }
        btn.onclick = function() { toggleSymptomSelection(sym, btn); };
        container.appendChild(btn);
      });
      // "í•´ë‹¹ ì¦ìƒ ì—†ìŒ" ë²„íŠ¼
      const clearBtn = document.createElement("button");
      clearBtn.className = "select-btn";
      clearBtn.textContent = "í•´ë‹¹ ì¦ìƒ ì—†ìŒ";
      if (selectedSymptoms.some(item => item.id === "None" + currentSymptomPage)) {
        clearBtn.classList.add("selected");
      }
      clearBtn.onclick = clearCurrentPageSelections;
      container.appendChild(clearBtn);
      document.getElementById("symptom-page-num").textContent = "í˜ì´ì§€ " + currentSymptomPage + " / 5";
    }
  </script>

  <!-- =======================
       5. ê²°ê³¼ í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜
  ======================= -->
  <script>
    // ì•” ì„¤ëª… íŒŒì‹± í•¨ìˆ˜: "Lung Cancer (C34) - íì—ì„œ ë°œìƒí•˜ëŠ” ì•…ì„± ì¢…ì–‘"
    function parseCancerDesc(desc) {
      const regex = /(.+?)\s*\((.+?)\)\s*-\s*(.+)/;
      const match = desc.match(regex);
      if (match) {
        return { englishName: match[1].trim(), code: match[2].trim(), simpleDesc: match[3].trim() };
      } else {
        return { englishName: "", code: "", simpleDesc: desc };
      }
    }
    function renderResultsPage() {
      // ğŸ”® ìœ„í—˜ ì§ˆí™˜ ë¶„ì„ (ì£¼í™©ìƒ‰ ì¹´ë“œ)
      const riskMap = {};
      selectedSymptoms.forEach(sym => {
        const disease = sym.riskDisease;
        if (!riskMap[disease]) {
          riskMap[disease] = { count: 0, cancerDesc: sym.cancerDesc };
        }
        riskMap[disease].count++;
      });
      let riskArray = [];
      for (const disease in riskMap) {
        riskArray.push({ disease: disease, count: riskMap[disease].count, cancerDesc: riskMap[disease].cancerDesc });
      }
      riskArray.sort((a, b) => b.count - a.count);
      function getRiskStars(count) {
        if (count >= 4) return "â­â­â­+";
        else if (count === 3) return "â­â­â­";
        else if (count === 2) return "â­â­";
        else return "â­";
      }
      let riskHtml = `<h2>ğŸ”® ìœ„í—˜ ì§ˆí™˜ ë¶„ì„</h2>
        <table>
          <tr>
            <th>ìœ„í—˜ ì§ˆí™˜</th>
            <th>ìœ„í—˜ë„</th>
            <th>ì˜ë¬¸ëª…</th>
            <th>ìƒë³‘ì½”ë“œ</th>
            <th>ê°„ë‹¨í•œ ì„¤ëª…</th>
          </tr>`;
      riskArray.forEach(item => {
        const stars = getRiskStars(item.count);
        const parsed = parseCancerDesc(item.cancerDesc);
        const rowStyle = (item.count >= 2) ? ' style="background-color: #b3e5fc;"' : "";
        riskHtml += `<tr${rowStyle}>
          <td>${item.disease}</td>
          <td>${stars}</td>
          <td>${parsed.englishName}</td>
          <td>${parsed.code}</td>
          <td>${parsed.simpleDesc}</td>
        </tr>`;
      });
      riskHtml += "</table>";
      document.getElementById("result-risk").innerHTML = riskHtml;
      
      // ğŸƒ ê²€ì§„ ì œì•ˆ (íŒŒë€ìƒ‰ ì¹´ë“œ)
      const examMap = {};
      selectedSymptoms.forEach(sym => {
        const key = sym.symptom + "|" + sym.riskDisease + "|" + sym.examSuggestion;
        examMap[key] = sym;
      });
      let examHtml = `<h2>ğŸƒ ê²€ì§„ ì œì•ˆ</h2>
        <table>
          <tr>
            <th>ì¦ìƒ</th>
            <th>ìœ„í—˜ ì§ˆí™˜</th>
            <th>ê²€ì§„ ì œì•ˆ</th>
          </tr>`;
      Object.values(examMap).forEach(sym => {
        examHtml += `<tr>
          <td>${sym.symptom}</td>
          <td>${sym.riskDisease}</td>
          <td>${sym.examSuggestion}</td>
        </tr>`;
      });
      examHtml += "</table>";
      document.getElementById("result-exam").innerHTML = examHtml;
      
      // âœ¨ êµ­ê°€ ì•”ê²€ì§„ ê°€ì´ë“œë¼ì¸ (ë…¹ìƒ‰ ì¹´ë“œ) + ì¶”ê°€ ì •ë³´ ì˜ì—­
      document.getElementById("result-guideline").innerHTML = screeningGuidelinesHTML +
      `<div class="extra-info" style="margin-top:20px; text-align:center;">
         <p style="font-size:1.3em;">ì•”ì— ëŒ€í•œ ë³´ë‹¤ ìì„¸í•œ ì •ë³´ëŠ”<br>ApuDa ì›¹ì•±ì—ì„œ í™•ì¸í•˜ì„¸ìš”</p>
         <a href="https://apuda.softr.app/" target="_blank">
           <img src="https://blog.kakaocdn.net/dn/QKUIH/btsLWuUGHPl/scNTqkbHpWf23q7KkvBjm0/img.webp" alt="ApuDa ì•±" style="max-width:35%; height:auto; border-radius:8px;">
         </a>
       </div>`;
    }
  </script>
  
  <!-- =======================
       6. HTML í˜ì´ì§€ êµ¬ì„±
  ======================= -->
  
  <!-- [1] ì²« í™”ë©´ (ì„œë¹„ìŠ¤ ì†Œê°œ ë° ê²€ì‚¬ ì‹œì‘) -->
  <div id="page1" class="page-section active">
    <div class="container">
      <!-- ì²« í™”ë©´: ì›Œí„°ë§ˆí¬ ì—†ìŒ -->
      <img src="https://blog.kakaocdn.net/dn/cDBIAl/btsL3lQEM39/N7WW1vH17Tl6BLEP5EfnKk/img.jpg" alt="ApuDa ë¡œê³ " style="width:200px; margin-bottom:20px; position: relative; z-index: 1;">
      <h1 style="position: relative; z-index: 1;">ApuDa ì•”ê²€ì§„</h1>
      <button class="btn blue-btn" onclick="goToPage2()" style="position: relative; z-index: 1;">ê²€ì‚¬ ì‹œì‘</button>
    </div>
    <div class="footer">
      <p>Â© ApuDa</p>
      <a href="https://cafe.naver.com/2ndpart" target="_blank">
        <img src="https://blog.kakaocdn.net/dn/bdLgDL/btsL1XDn7FF/Dlkt2Ek2lH4R9HIVVX6oEk/img.jpg" alt="ë„¤ì´ë²„ ì¹´í˜ ë¡œê³ ">
      </a>
    </div>
  </div>
  
  <!-- [2] ì—°ë ¹ ë° ì„±ë³„ ì„ íƒ í˜ì´ì§€ -->
  <div id="page2" class="page-section">
    <div class="container">
      <!-- ìƒë‹¨ í—¤ë” í…ìŠ¤íŠ¸ -->
      <div class="header-watermark">
        <div class="wm-subtitle">ì•„í”„ì§€ë§Œ ë‹¤í–‰ì´ë‹¤</div>
        <div class="wm-title">ApuDa</div>
      </div>
      <h2>ì—°ë ¹ ë° ì„±ë³„ ì„ íƒ</h2>
      <h3>ì—°ë ¹ëŒ€</h3>
      <div class="select-grid">
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','10ëŒ€')">10ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','20ëŒ€')">20ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','30ëŒ€')">30ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','40ëŒ€')">40ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','50ëŒ€')">50ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','60ëŒ€')">60ëŒ€</button>
        <button class="select-btn" data-type="age" onclick="toggleSelection(this,'age','70ëŒ€ ì´ìƒ')">70ëŒ€ ì´ìƒ</button>
      </div>
      <h3>ì„±ë³„</h3>
      <div class="select-grid">
        <button class="select-btn" data-type="gender" onclick="toggleSelection(this,'gender','ë‚¨ì„±')">ë‚¨ì„±</button>
        <button class="select-btn" data-type="gender" onclick="toggleSelection(this,'gender','ì—¬ì„±')">ì—¬ì„±</button>
      </div>
      <button class="btn blue-btn" onclick="if(!selectedAge || !selectedGender){alert('í•´ë‹¹ í•­ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”');} else { goToSymptomPage(1); }">ë‹¤ìŒ</button>
    </div>
    <div class="footer">
      <p>Â© ApuDa</p>
      <a href="https://cafe.naver.com/2ndpart" target="_blank">
        <img src="https://blog.kakaocdn.net/dn/bdLgDL/btsL1XDn7FF/Dlkt2Ek2lH4R9HIVVX6oEk/img.jpg" alt="ë„¤ì´ë²„ ì¹´í˜ ë¡œê³ ">
      </a>
    </div>
  </div>
  
  <!-- [3] ì¦ìƒ ì„ íƒ í˜ì´ì§€ (5í˜ì´ì§€ êµ¬ì„±) -->
  <div id="page3" class="page-section">
    <div class="container">
      <!-- ìƒë‹¨ í—¤ë” í…ìŠ¤íŠ¸ -->
      <div class="header-watermark">
        <div class="wm-subtitle">ì•„í”„ì§€ë§Œ ë‹¤í–‰ì´ë‹¤</div>
        <div class="wm-title">ApuDa</div>
      </div>
      <!-- ì¦ìƒ ì„ íƒ ì œëª©: "ë‚¨ì„± ì¦ìƒ ì„ íƒ X" ë˜ëŠ” "ì—¬ì„± ì¦ìƒ ì„ íƒ X" -->
      <h2 id="symptom-heading"></h2>
      <p id="symptom-page-num">í˜ì´ì§€ 1 / 5</p>
      <div id="symptom-container">
        <!-- ì¦ìƒ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë¨ -->
      </div>
      <div>
        <button class="btn blue-btn" onclick="previousSymptomPage()"><- ì´ì „</button>
        <button class="btn blue-btn" onclick="nextSymptomPage()">ë‹¤ìŒ</button>
      </div>
    </div>
    <div class="footer">
      <p>Â© ApuDa</p>
      <a href="https://cafe.naver.com/2ndpart" target="_blank">
        <img src="https://blog.kakaocdn.net/dn/bdLgDL/btsL1XDn7FF/Dlkt2Ek2lH4R9HIVVX6oEk/img.jpg" alt="ë„¤ì´ë²„ ì¹´í˜ ë¡œê³ ">
      </a>
    </div>
  </div>
  
  <!-- [4] ê²°ê³¼ í˜ì´ì§€ -->
  <div id="page8" class="page-section">
    <div class="container result-container">
      <!-- ê²°ê³¼ í˜ì´ì§€ ì œëª© â€“ íŒŒë€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
      <h1 class="result-title">ApuDa ê²€ì§„ê²°ê³¼</h1>
      <!-- ìœ„í—˜ ì§ˆí™˜ ë¶„ì„ (ì£¼í™©ìƒ‰ ì¹´ë“œ) -->
      <div class="info-card card-orange" id="result-risk">
        <!-- ìœ„í—˜ ì§ˆí™˜ ë¶„ì„ í…Œì´ë¸” ë Œë” -->
      </div>
      <!-- ê²€ì§„ ì œì•ˆ (íŒŒë€ìƒ‰ ì¹´ë“œ) -->
      <div class="info-card card-blue" id="result-exam">
        <!-- ê²€ì§„ ì œì•ˆ í…Œì´ë¸” ë Œë” -->
      </div>
      <!-- êµ­ê°€ ì•”ê²€ì§„ ê°€ì´ë“œë¼ì¸ (ë…¹ìƒ‰ ì¹´ë“œ) + ì¶”ê°€ ì •ë³´ ì˜ì—­ -->
      <div class="info-card card-green" id="result-guideline">
        <!-- êµ­ê°€ ì•”ê²€ì§„ ê°€ì´ë“œë¼ì¸ ë° ì¶”ê°€ ì •ë³´ ë Œë” -->
      </div>
      <button class="btn blue-btn" onclick="restart()">ë‹¤ì‹œ ê²€ì‚¬</button>
    </div>
    <div class="footer">
      <p>Â© ApuDa</p>
      <a href="https://cafe.naver.com/2ndpart" target="_blank">
        <img src="https://blog.kakaocdn.net/dn/bdLgDL/btsL1XDn7FF/Dlkt2Ek2lH4R9HIVVX6oEk/img.jpg" alt="ë„¤ì´ë²„ ì¹´í˜ ë¡œê³ ">
      </a>
    </div>
  </div>
  
  <!-- =======================
       7. ê²°ê³¼ í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜ (ì¤‘ë³µ ì •ì˜ ì œê±°ë¥¼ ìœ„í•´ ë§ˆì§€ë§‰ ìŠ¤í¬ë¦½íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€)
  ======================= -->
  <script>
    // ì•” ì„¤ëª… íŒŒì‹± í•¨ìˆ˜: "Lung Cancer (C34) - íì—ì„œ ë°œìƒí•˜ëŠ” ì•…ì„± ì¢…ì–‘"
    function parseCancerDesc(desc) {
      const regex = /(.+?)\s*\((.+?)\)\s*-\s*(.+)/;
      const match = desc.match(regex);
      if (match) {
        return { englishName: match[1].trim(), code: match[2].trim(), simpleDesc: match[3].trim() };
      } else {
        return { englishName: "", code: "", simpleDesc: desc };
      }
    }
    function renderResultsPage() {
      // ğŸ”® ìœ„í—˜ ì§ˆí™˜ ë¶„ì„ (ì£¼í™©ìƒ‰ ì¹´ë“œ)
      const riskMap = {};
      selectedSymptoms.forEach(sym => {
        const disease = sym.riskDisease;
        if (!riskMap[disease]) {
          riskMap[disease] = { count: 0, cancerDesc: sym.cancerDesc };
        }
        riskMap[disease].count++;
      });
      let riskArray = [];
      for (const disease in riskMap) {
        riskArray.push({ disease: disease, count: riskMap[disease].count, cancerDesc: riskMap[disease].cancerDesc });
      }
      riskArray.sort((a, b) => b.count - a.count);
      function getRiskStars(count) {
        if (count >= 4) return "â­â­â­+";
        else if (count === 3) return "â­â­â­";
        else if (count === 2) return "â­â­";
        else return "â­";
      }
      let riskHtml = `<h2>ğŸ”® ìœ„í—˜ ì§ˆí™˜ ë¶„ì„</h2>
        <table>
          <tr>
            <th>ìœ„í—˜ ì§ˆí™˜</th>
            <th>ìœ„í—˜ë„</th>
            <th>ì˜ë¬¸ëª…</th>
            <th>ìƒë³‘ì½”ë“œ</th>
            <th>ê°„ë‹¨í•œ ì„¤ëª…</th>
          </tr>`;
      riskArray.forEach(item => {
        const stars = getRiskStars(item.count);
        const parsed = parseCancerDesc(item.cancerDesc);
        const rowStyle = (item.count >= 2) ? ' style="background-color: #b3e5fc;"' : "";
        riskHtml += `<tr${rowStyle}>
          <td>${item.disease}</td>
          <td>${stars}</td>
          <td>${parsed.englishName}</td>
          <td>${parsed.code}</td>
          <td>${parsed.simpleDesc}</td>
        </tr>`;
      });
      riskHtml += "</table>";
      document.getElementById("result-risk").innerHTML = riskHtml;
      
      // ğŸƒ ê²€ì§„ ì œì•ˆ (íŒŒë€ìƒ‰ ì¹´ë“œ)
      const examMap = {};
      selectedSymptoms.forEach(sym => {
        const key = sym.symptom + "|" + sym.riskDisease + "|" + sym.examSuggestion;
        examMap[key] = sym;
      });
      let examHtml = `<h2>ğŸƒ ê²€ì§„ ì œì•ˆ</h2>
        <table>
          <tr>
            <th>ì¦ìƒ</th>
            <th>ìœ„í—˜ ì§ˆí™˜</th>
            <th>ê²€ì§„ ì œì•ˆ</th>
          </tr>`;
      Object.values(examMap).forEach(sym => {
        examHtml += `<tr>
          <td>${sym.symptom}</td>
          <td>${sym.riskDisease}</td>
          <td>${sym.examSuggestion}</td>
        </tr>`;
      });
      examHtml += "</table>";
      document.getElementById("result-exam").innerHTML = examHtml;
      
      // âœ¨ êµ­ê°€ ì•”ê²€ì§„ ê°€ì´ë“œë¼ì¸ (ë…¹ìƒ‰ ì¹´ë“œ) + ì¶”ê°€ ì •ë³´ ì˜ì—­
      document.getElementById("result-guideline").innerHTML = screeningGuidelinesHTML +
      `<div class="extra-info" style="margin-top:20px; text-align:center;">
         <p style="font-size:1.3em;">ì•”ì— ëŒ€í•œ ë³´ë‹¤ ìì„¸í•œ ì •ë³´ëŠ”<br>ApuDa ì›¹ì•±ì—ì„œ í™•ì¸í•˜ì„¸ìš”</p>
         <a href="https://apuda.softr.app/" target="_blank">
           <img src="https://blog.kakaocdn.net/dn/QKUIH/btsLWuUGHPl/scNTqkbHpWf23q7KkvBjm0/img.webp" alt="ApuDa ì•±" style="max-width:35%; height:auto; border-radius:8px;">
         </a>
       </div>`;
    }
  </script>
</body>
</html>
